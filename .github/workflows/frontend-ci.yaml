# Workflow name
name: frontend-ci

# Triggers for the workflow
on:
  # Manual trigger using the workflow_dispatch event
  workflow_dispatch:

  # Automatic trigger on pull_request events to the main branch
  pull_request:
    branches:
    - main

# Jobs defined in the workflow
jobs:
  pre-build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x, 18.x]
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    - run: cd starter/frontend && npm test
    - run: cd starter/frontend && npm run lint

  test-job:
    name: Test
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: Perform a cache action to restore cache before dependency install
      uses: actions/cache@v3
      with:
        path: ~/.npm # Adjust this path based on your package manager
        key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-npm-

    - name: Install dependencies and Run the npm run test command
      working-directory: ./starter/frontend
      run: |
        npm i  # Adjust based on your project setup
        npm run test  # Test JOB

  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x, 18.x]
    needs: pre-build
    steps:
    - run: |
        cd starter/frontend && npm run build
        echo "Hello ${{github.actor}}. You pushed to ${{github.repository}} at $(date)."
